<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <title>Simple markers</title>
    <style>
      html, body, #map-canvas {
        height: 100%;
        margin: 0px;
        padding: 0px
      }
    </style>
    <script src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
    <script src="https://maps.googleapis.com/maps/api/js?v=3.exp"></script>
    <script src="http://google-maps-utility-library-v3.googlecode.com/svn/trunk/markerclusterer/src/markerclusterer_compiled.js"></script>
        <script>

function initialize() {


  var myLatlng = new google.maps.LatLng(40.19461,-8.41175);
  var mapOptions = {
    zoom: 12,
    center: myLatlng
  }
  var map = new google.maps.Map(document.getElementById('map-canvas'), mapOptions);

  $.ajax({
    url: "/api/distrito/Coimbra",
    type: "GET",
    dataType: 'json',
  }).success(function(data) {


    var infowindow = new google.maps.InfoWindow();

    var marker, i;
    var markers = [];

    var contentString = '<div id="content">'+
      '<div id="siteNotice">'+
      '</div>'+
      '<h1 id="firstHeading" class="firstHeading">%titulo%</h1>'+
      '<div id="bodyContent">'+
      '<p>%texto%</p>'+
      '</div>'+
      '</div>';

    for (i = 0; i < data.data.length; i++) {  
      marker = new google.maps.Marker({
        position: new google.maps.LatLng(data.data[i].gps.lat, data.data[i].gps.lng),
        map: map,
        title: data.data[i].nome
      });

      markers.push(marker);

      google.maps.event.addListener(marker, 'click', (function(marker, i) {
        return function() {
          infowindow.setContent(contentString.replace("%titulo%",data.data[i].nome).replace("%texto%",data.data[i].descricao));
          infowindow.open(map, marker);
        }
      })(marker, i));
    }

    var markerCluster = new MarkerClusterer(map, markers, {gridSize: 50, maxZoom: 15});
  });


}

$( document ).ready(function() {

  google.maps.event.addDomListener(window, 'load', initialize);

});
    </script>
  </head>
  <body>
    <div id="map-canvas"></div>
  </body>
</html>